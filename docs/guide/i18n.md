# 国际化

Aix 提供了强大而灵活的国际化系统，基于 Vue 3 的响应式特性实现。

## 架构概览

Aix 的国际化系统采用三层架构设计：

```
全局 LocaleContext (zh-CN | en-US)
    ↓
公共语言包 (commonLocale)
    ↓
组件特有语言包 (buttonLocale, inputLocale...)
    ↓
合并后的完整文案 (t.value)
```

## 安装

国际化功能集成在 `@aix/hooks` 包中：

```bash
pnpm add @aix/hooks
```

## 快速开始

### 1. 创建全局 Locale Context

在应用入口创建全局语言上下文：

```typescript
// main.ts
import { createApp } from 'vue';
import { createLocale } from '@aix/hooks';
import App from './App.vue';

const app = createApp(App);

// 创建并安装 locale context（默认中文）
const { install } = createLocale('zh-CN');
app.use({ install });

app.mount('#app');
```

### 2. 在组件中使用

#### 方式一：使用公共语言包

```vue
<script setup lang="ts">
import { useCommonLocale } from '@aix/hooks';

const { t, locale } = useCommonLocale();
</script>

<template>
  <div>
    <button>{{ t.confirm }}</button>
    <button>{{ t.cancel }}</button>
    <p>当前语言: {{ locale }}</p>
  </div>
</template>
```

#### 方式二：使用组件特有语言包

```vue
<script setup lang="ts">
import { useLocale } from '@aix/hooks';
import { buttonLocale } from '@aix/button';

// 自动合并公共语言包和组件语言包
const { t } = useLocale(buttonLocale);
</script>

<template>
  <div>
    <!-- 来自公共语言包 -->
    <button>{{ t.submit }}</button>

    <!-- 来自 buttonLocale -->
    <button>{{ t.loading }}</button>
  </div>
</template>
```

## 核心 API

### createLocale

创建全局语言上下文，管理应用的语言状态。

**参数**：
- `initialLocale`: 初始语言（`'zh-CN'` | `'en-US'`，默认 `'zh-CN'`）

**返回值**：
```typescript
{
  install: (app: App) => void;        // Vue 插件安装函数
  localeContext: {
    locale: Ref<Locale>;              // 当前语言（响应式）
    setLocale: (locale: Locale) => void;  // 切换语言
  }
}
```

**特性**：
- ✅ **响应式**：语言变化自动更新所有组件
- ✅ **持久化**：自动保存到 localStorage
- ✅ **事件通知**：触发 `aix-locale-change` 自定义事件
- ✅ **SSR 兼容**：自动检测环境

**示例**：

```typescript
import { createLocale } from '@aix/hooks';

// 创建并配置
const { install, localeContext } = createLocale('zh-CN');

// 安装到 Vue
app.use({ install });

// 切换语言
localeContext.setLocale('en-US');

// 监听语言变化
window.addEventListener('aix-locale-change', (e: CustomEvent) => {
  console.log('语言已切换:', e.detail); // 'en-US'
});
```

### useLocale

组件级国际化 Hook，自动合并公共语言包和组件特有语言包。

**参数**：
```typescript
useLocale<T>(
  componentLocale: LocaleMessages<T>,
  overrideLocale?: MaybeRef<Locale>
)
```

**返回值**：
```typescript
{
  t: ComputedRef<T & CommonMessages>;    // 合并后的文案对象
  locale: ComputedRef<Locale>;           // 当前语言
}
```

**示例**：

```typescript
import { useLocale } from '@aix/hooks';

// 定义组件语言包
const myLocale = {
  'zh-CN': {
    title: '标题',
    description: '描述',
  },
  'en-US': {
    title: 'Title',
    description: 'Description',
  },
};

const { t, locale } = useLocale(myLocale);

// 使用文案
console.log(t.value.title);        // '标题' 或 'Title'
console.log(t.value.confirm);      // '确认' 或 'Confirm' (来自公共语言包)
```

### useCommonLocale

仅使用公共语言包的轻量级版本。

**参数**：
```typescript
useCommonLocale(overrideLocale?: MaybeRef<Locale>)
```

**返回值**：
```typescript
{
  t: ComputedRef<CommonMessages>;   // 公共文案对象
  locale: ComputedRef<Locale>;      // 当前语言
}
```

## 公共语言包

所有组件共享的通用文案（20+ 条）：

| 中文 | 英文 | 键名 |
|------|------|------|
| 确认 | Confirm | `confirm` |
| 取消 | Cancel | `cancel` |
| 好的 | OK | `ok` |
| 关闭 | Close | `close` |
| 提交 | Submit | `submit` |
| 重置 | Reset | `reset` |
| 保存 | Save | `save` |
| 删除 | Delete | `delete` |
| 编辑 | Edit | `edit` |
| 搜索 | Search | `search` |
| 添加 | Add | `add` |
| 加载中... | Loading... | `loading` |
| 暂无数据 | No Data | `noData` |
| 成功 | Success | `success` |
| 错误 | Error | `error` |
| 警告 | Warning | `warning` |
| 信息 | Info | `info` |
| 清空 | Clear | `clear` |
| 全选 | Select All | `selectAll` |
| 上一页 | Previous | `prev` |
| 下一页 | Next | `next` |
| 共 {total} 条 | Total {total} items | `total` |

**类型定义**：

```typescript
import type { CommonMessages } from '@aix/hooks';

// 在代码中使用
const t: CommonMessages = {
  confirm: '确认',
  cancel: '取消',
  // ...
};
```

## 高级用法

### 动态切换语言

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { createLocale, useCommonLocale } from '@aix/hooks';

const { localeContext } = createLocale();
const { t, locale } = useCommonLocale();

const languages = [
  { value: 'zh-CN', label: '简体中文' },
  { value: 'en-US', label: 'English' },
];

function switchLanguage(newLocale: 'zh-CN' | 'en-US') {
  localeContext.setLocale(newLocale);
}
</script>

<template>
  <div>
    <select :value="locale" @change="switchLanguage($event.target.value)">
      <option v-for="lang in languages" :key="lang.value" :value="lang.value">
        {{ lang.label }}
      </option>
    </select>

    <p>{{ t.confirm }}</p>
  </div>
</template>
```

### 覆盖全局语言

在某些组件中临时使用不同的语言：

```vue
<script setup lang="ts">
import { ref } from 'vue';
import { useLocale } from '@aix/hooks';
import { buttonLocale } from '@aix/button';

const customLocale = ref<'zh-CN' | 'en-US'>('en-US');

// 覆盖全局语言设置
const { t } = useLocale(buttonLocale, customLocale);
</script>

<template>
  <div>
    <!-- 始终显示英文，不受全局语言影响 -->
    <button>{{ t.submit }}</button>
  </div>
</template>
```

### 创建自定义语言包

```typescript
// locales/my-component.ts
import type { LocaleMessages } from '@aix/hooks';

export interface MyComponentLocale {
  title: string;
  description: string;
  actions: {
    save: string;
    cancel: string;
  };
}

export const myComponentLocale: LocaleMessages<MyComponentLocale> = {
  'zh-CN': {
    title: '我的组件',
    description: '这是一个示例组件',
    actions: {
      save: '保存',
      cancel: '取消',
    },
  },
  'en-US': {
    title: 'My Component',
    description: 'This is an example component',
    actions: {
      save: 'Save',
      cancel: 'Cancel',
    },
  },
};
```

**在组件中使用**：

```vue
<script setup lang="ts">
import { useLocale } from '@aix/hooks';
import { myComponentLocale } from './locales/my-component';

const { t } = useLocale(myComponentLocale);
</script>

<template>
  <div>
    <h1>{{ t.title }}</h1>
    <p>{{ t.description }}</p>
    <button>{{ t.actions.save }}</button>
    <button>{{ t.actions.cancel }}</button>
  </div>
</template>
```

### 添加新语言

扩展国际化系统以支持更多语言：

```typescript
// 1. 扩展 Locale 类型
declare module '@aix/hooks' {
  export type Locale = 'zh-CN' | 'en-US' | 'ja-JP' | 'ko-KR';
}

// 2. 扩展公共语言包
import { commonLocale } from '@aix/hooks';

commonLocale['ja-JP'] = {
  confirm: '確認',
  cancel: 'キャンセル',
  ok: 'OK',
  // ...
};

commonLocale['ko-KR'] = {
  confirm: '확인',
  cancel: '취소',
  ok: '확인',
  // ...
};

// 3. 扩展组件语言包
import { buttonLocale } from '@aix/button';

buttonLocale['ja-JP'] = {
  loading: '読み込み中...',
};

buttonLocale['ko-KR'] = {
  loading: '로딩 중...',
};
```

## SSR 支持

国际化系统完全兼容服务端渲染：

```typescript
// 服务端
import { createLocale } from '@aix/hooks';
import { renderToString } from 'vue/server-renderer';

const { install } = createLocale('zh-CN');
const app = createSSRApp(App);
app.use({ install });

const html = await renderToString(app);
```

**自动检测**：
- 在服务端环境中，自动禁用 localStorage 和自定义事件
- 在客户端环境中，自动启用持久化和事件通知

## 最佳实践

### 1. 统一管理语言包

```typescript
// locales/index.ts
export { buttonLocale } from '@aix/button';
export { inputLocale } from '@aix/input';
export { myComponentLocale } from './my-component';
```

### 2. 类型安全

```typescript
import type { LocaleMessages } from '@aix/hooks';

// ✅ 正确：使用类型定义
const myLocale: LocaleMessages<{ title: string }> = {
  'zh-CN': { title: '标题' },
  'en-US': { title: 'Title' },
};

// ❌ 错误：缺少类型
const badLocale = {
  'zh-CN': { title: '标题' },
  // 忘记添加 'en-US'
};
```

### 3. 避免硬编码文案

```vue
<!-- ✅ 正确 -->
<button>{{ t.submit }}</button>

<!-- ❌ 错误 -->
<button>提交</button>
```

### 4. 合理使用公共语言包

```typescript
// ✅ 通用文案使用公共语言包
const { t } = useCommonLocale();
console.log(t.value.confirm);

// ✅ 组件特有文案单独定义
const { t } = useLocale(myComponentLocale);
console.log(t.value.customMessage);
```

## 故障排查

### 问题：语言切换后未生效

**原因**：未安装全局 locale context

**解决**：
```typescript
// main.ts
import { createLocale } from '@aix/hooks';

const { install } = createLocale('zh-CN');
app.use({ install });
```

### 问题：SSR 时报错 localStorage 未定义

**原因**：国际化系统已自动处理，检查其他代码

**解决**：
```typescript
// ✅ 正确：使用环境检测
const isClient = typeof window !== 'undefined';
if (isClient) {
  localStorage.setItem('key', 'value');
}
```

## 参考资源

- [Vue 3 Composition API](https://vuejs.org/guide/extras/composition-api-faq.html)
- [i18n 最佳实践](https://www.i18next.com/principles/best-practices)

## 相关文档

- [快速开始](/guide/getting-started)
- [组件文档](/components/)
- [主题定制](/guide/theme)
