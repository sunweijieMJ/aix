# ç»„ä»¶åº“è”è°ƒå·¥å…·è„šæœ¬

æœ¬ç›®å½•åŒ…å«ç”¨äº**å¤–éƒ¨ä¸šåŠ¡é¡¹ç›®**è”è°ƒçš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼ŒåŸºäº Yalc å®ç°ã€‚

**é€‚ç”¨åœºæ™¯ï¼š** å½“ä½ çš„ä¸šåŠ¡é¡¹ç›®åœ¨å¤–éƒ¨ä»“åº“ï¼ˆä¸åœ¨æ­¤ monorepo å†…ï¼‰æ—¶ï¼Œä½¿ç”¨è¿™äº›å·¥å…·è¿›è¡Œç»„ä»¶åº“è”è°ƒã€‚

**æ³¨æ„ï¼š** å¦‚æœä½ çš„é¡¹ç›®åœ¨ monorepo å†…ï¼ˆå¦‚ `apps/example`ï¼‰ï¼Œæ¨èä½¿ç”¨æºç æ¨¡å¼ï¼ˆVite aliasï¼‰ï¼Œæ— éœ€ yalcã€‚è¯¦è§ [ç¤ºä¾‹é¡¹ç›®æ–‡æ¡£](../../apps/example/README.md)ã€‚

---

## ğŸ”§ ç¯å¢ƒè¦æ±‚

åœ¨ä½¿ç”¨è¿™äº›å·¥å…·å‰ï¼Œè¯·ç¡®ä¿æ»¡è¶³ä»¥ä¸‹ç‰ˆæœ¬è¦æ±‚ï¼š

| å·¥å…· | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|---------|------|
| **Node.js** | >= 22.0.0 | 22.x LTS | å¿…éœ€ |
| **pnpm** | >= 10.0.0 | 10.x | å¿…éœ€ |
| **yalc** | latest | latest | è‡ªåŠ¨å®‰è£… |

**æ£€æŸ¥ç¯å¢ƒï¼š**
```bash
pnpm link:setup  # è‡ªåŠ¨æ£€æŸ¥ç‰ˆæœ¬å¹¶å®‰è£… yalc
```

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### setup.ts - ç¯å¢ƒæ£€æŸ¥å·¥å…·

æ£€æŸ¥å¹¶å®‰è£… Yalc ç¯å¢ƒï¼Œæ˜¾ç¤ºä½¿ç”¨æŒ‡å—ã€‚

**ç”¨é€”**ï¼š
- æ£€æµ‹ Yalc æ˜¯å¦å·²å®‰è£…
- è‡ªåŠ¨å®‰è£… Yalcï¼ˆå¦‚æœªå®‰è£…ï¼‰
- æ˜¾ç¤ºè”è°ƒä½¿ç”¨æŒ‡å—

**ä½¿ç”¨**ï¼š
```bash
pnpm link:setup
```

**åŠŸèƒ½**ï¼š
- âœ… æ£€æµ‹ `yalc --version`
- âœ… æœªå®‰è£…æ—¶æ‰§è¡Œ `npm install -g yalc`
- âœ… æ˜¾ç¤ºä¸¤ç§è”è°ƒæ¨¡å¼çš„ä½¿ç”¨è¯´æ˜

---

### publish.ts - Yalc å‘å¸ƒå·¥å…·

äº¤äº’å¼å‘å¸ƒç»„ä»¶åŒ…åˆ° Yalc æœ¬åœ°ä»“åº“ã€‚

**ç”¨é€”**ï¼š
- é€‰æ‹©è¦å‘å¸ƒçš„ç»„ä»¶åŒ…
- è‡ªåŠ¨æ„å»ºï¼ˆå¦‚æœªæ„å»ºï¼‰
- å‘å¸ƒåˆ° Yalc æœ¬åœ°ä»“åº“

**ä½¿ç”¨**ï¼š
```bash
pnpm link:publish
```

**å·¥ä½œæµç¨‹**ï¼š
1. æ‰«æ `packages/` ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…
2. æ˜¾ç¤ºå¯é€‰æ‹©çš„åŒ…åˆ—è¡¨ï¼ˆæ”¯æŒå¤šé€‰ + å…¨é€‰ï¼‰
3. æ£€æŸ¥åŒ…æ˜¯å¦å·²æ„å»ºï¼ˆæ£€æŸ¥ `es/` æˆ– `lib/` ç›®å½•ï¼‰
4. æœªæ„å»ºçš„åŒ…è‡ªåŠ¨æ‰§è¡Œ `pnpm build`
5. å¯¹æ¯ä¸ªåŒ…æ‰§è¡Œ `yalc publish`
6. æ˜¾ç¤ºä¸‹ä¸€æ­¥æ“ä½œæç¤º

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
ğŸš€ Yalc å‘å¸ƒå·¥å…·

è¯·é€‰æ‹©è¦å‘å¸ƒçš„åŒ…:
  â—‰ å…¨éƒ¨
  â—¯ @aix/button
  â—¯ @aix/theme
  â—¯ @aix/hooks

ğŸ“¦ å‘å¸ƒ button...
âœ“ button å‘å¸ƒæˆåŠŸ

ğŸ“– ä¸‹ä¸€æ­¥:
  åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­æ‰§è¡Œ:
    yalc add @aix/button
```

**æŠ€æœ¯å®ç°**ï¼š
- ä½¿ç”¨ `inquirer` æä¾›äº¤äº’å¼é€‰æ‹©
- ä½¿ç”¨ `chalk` ç¾åŒ–è¾“å‡º
- è‡ªåŠ¨æ£€æµ‹æ„å»ºçŠ¶æ€
- é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º

---

### push.ts - Yalc æ¨é€å·¥å…·

æ¨é€æ›´æ–°åˆ°å·²é“¾æ¥çš„ä¸šåŠ¡é¡¹ç›®ã€‚

**ç”¨é€”**ï¼š
- é€‰æ‹©è¦æ›´æ–°çš„ç»„ä»¶åŒ…
- è‡ªåŠ¨é‡æ–°æ„å»º
- æ¨é€åˆ°æ‰€æœ‰å·²é“¾æ¥çš„é¡¹ç›®

**ä½¿ç”¨**ï¼š
```bash
pnpm link:push
```

**å·¥ä½œæµç¨‹**ï¼š
1. æ‰«æ `packages/` ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…
2. æ˜¾ç¤ºå¯é€‰æ‹©çš„åŒ…åˆ—è¡¨ï¼ˆæ”¯æŒå¤šé€‰ + å…¨é€‰ï¼‰
3. å¯¹æ¯ä¸ªåŒ…ï¼š
   - æ‰§è¡Œ `pnpm build` é‡æ–°æ„å»º
   - æ‰§è¡Œ `yalc push` æ¨é€åˆ°æ‰€æœ‰é“¾æ¥çš„é¡¹ç›®
4. æ˜¾ç¤ºå®Œæˆæç¤º

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¿®æ”¹ç»„ä»¶åº“ä»£ç åå¿«é€Ÿæ›´æ–°ä¸šåŠ¡é¡¹ç›®
- æµ‹è¯•æ‰“åŒ…äº§ç‰©æ˜¯å¦æ­£å¸¸
- å¤šä¸ªä¸šåŠ¡é¡¹ç›®åŒæ—¶è”è°ƒ

---

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹ï¼ˆå¤–éƒ¨ä¸šåŠ¡é¡¹ç›®ï¼‰

### å‡†å¤‡å·¥ä½œï¼ˆä¸€æ¬¡æ€§ï¼‰

```bash
# 1. åœ¨ç»„ä»¶åº“æ ¹ç›®å½•æ£€æŸ¥ç¯å¢ƒ
cd /path/to/aix
pnpm link:setup

# 2. å¤åˆ¶è„šæœ¬åˆ°ä¸šåŠ¡é¡¹ç›®
mkdir -p /path/to/your-business-project/scripts
cp apps/example/scripts/add-yalc.ts /path/to/your-business-project/scripts/
cp apps/example/scripts/remove-yalc.ts /path/to/your-business-project/scripts/

# 3. åœ¨ä¸šåŠ¡é¡¹ç›®æ·»åŠ  scripts å’Œä¾èµ–
cd /path/to/your-business-project
# ç¼–è¾‘ package.json æ·»åŠ ï¼š
{
  "scripts": {
    "add:yalc": "tsx scripts/add-yalc.ts",
    "remove:yalc": "tsx scripts/remove-yalc.ts"
  },
  "devDependencies": {
    "tsx": "latest",
    "chalk": "^5.3.0",
    "inquirer": "^10.2.0"
  }
}
```

### é¦–æ¬¡è”è°ƒ

```bash
# 1. å‘å¸ƒç»„ä»¶åº“åˆ° Yalcï¼ˆåœ¨ç»„ä»¶åº“æ ¹ç›®å½•ï¼‰
cd /path/to/aix
pnpm link:publish
# é€‰æ‹©è¦å‘å¸ƒçš„åŒ…

# 2. åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­æ·»åŠ ï¼ˆè‡ªåŠ¨ä¿å­˜ç‰ˆæœ¬ï¼‰
cd /path/to/your-business-project
pnpm add:yalc
# äº¤äº’å¼é€‰æ‹©è¦æ·»åŠ çš„åŒ…
```

### æ—¥å¸¸å¼€å‘

```bash
# 1. åœ¨ç»„ä»¶åº“ä¿®æ”¹ä»£ç 
cd /path/to/aix
# ç¼–è¾‘ packages/button/src/Button.vue

# 2. æ¨é€æ›´æ–°åˆ°ä¸šåŠ¡é¡¹ç›®
pnpm link:push
# é€‰æ‹©è¦æ¨é€çš„åŒ…

# 3. ä¸šåŠ¡é¡¹ç›®ä¼šè‡ªåŠ¨æ›´æ–°ä¾èµ–
# åˆ‡æ¢åˆ°ä¸šåŠ¡é¡¹ç›®ï¼Œåˆ·æ–°æµè§ˆå™¨æŸ¥çœ‹æ•ˆæœ
```

### å®Œæˆè”è°ƒåæ¸…ç†

```bash
cd /path/to/your-business-project
pnpm remove:yalc  # è‡ªåŠ¨æ¢å¤åŸå§‹ç‰ˆæœ¬
```

**å·¥ä½œåŸç†ï¼š**
- `add:yalc` - è‡ªåŠ¨ä¿å­˜å½“å‰ npm åŒ…ç‰ˆæœ¬ï¼Œäº¤äº’å¼é€‰æ‹©è¦æ·»åŠ çš„åŒ…
- `remove:yalc` - ç§»é™¤ yalc é“¾æ¥å¹¶è‡ªåŠ¨æ¢å¤åŸå§‹ç‰ˆæœ¬
- `.yalc.backup.json` - è‡ªåŠ¨ç®¡ç†ï¼Œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

**è¯¦ç»†æ–‡æ¡£ï¼š** æŸ¥çœ‹ [apps/example/scripts/README.md](../../apps/example/scripts/README.md) äº†è§£è„šæœ¬è¯¦ç»†ä½¿ç”¨è¯´æ˜

---

## ğŸ› ï¸ æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–

æ‰€æœ‰è„šæœ¬ä¾èµ–ä»¥ä¸‹ npm åŒ…ï¼ˆå·²åœ¨æ ¹ package.json ä¸­ï¼‰ï¼š

- `chalk` - ç»ˆç«¯é¢œè‰²è¾“å‡º
- `inquirer` - äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢
- `tsx` - TypeScript æ‰§è¡Œå™¨

### é”™è¯¯å¤„ç†

æ‰€æœ‰è„šæœ¬éƒ½åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†ï¼š

- âœ… æ£€æµ‹å‘½ä»¤æ‰§è¡Œå¤±è´¥
- âœ… æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
- âœ… æä¾›è§£å†³æ–¹æ¡ˆå»ºè®®
- âœ… éé›¶é€€å‡ºç ï¼ˆä¾¿äº CI/CDï¼‰

### ç›®å½•æ‰«æ

è„šæœ¬è‡ªåŠ¨æ‰«æ `packages/` ç›®å½•ï¼š

```typescript
const PACKAGES_DIR = join(process.cwd(), 'packages');

function getPackages(): string[] {
  return readdirSync(PACKAGES_DIR).filter((name) => {
    const pkgPath = join(PACKAGES_DIR, name);
    return statSync(pkgPath).isDirectory() &&
           existsSync(join(pkgPath, 'package.json'));
  });
}
```

### æ„å»ºæ£€æµ‹

æ£€æŸ¥ `es/` æˆ– `lib/` ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š

```typescript
function isPackageBuilt(pkgName: string): boolean {
  const pkgPath = join(PACKAGES_DIR, pkgName);
  return existsSync(join(pkgPath, 'es')) ||
         existsSync(join(pkgPath, 'lib'));
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¤ºä¾‹é¡¹ç›®æ–‡æ¡£](../../apps/example/README.md) - monorepo å†…éƒ¨é¡¹ç›®è”è°ƒ
- å¤–éƒ¨ä¸šåŠ¡é¡¹ç›®è¯·å‚è€ƒæœ¬æ–‡æ¡£çš„ Yalc ä½¿ç”¨è¯´æ˜

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹ packages ç›®å½•

å¦‚æœä½ çš„åŒ…ä¸åœ¨ `packages/` ç›®å½•ä¸‹ï¼Œä¿®æ”¹å¸¸é‡ï¼š

```typescript
const PACKAGES_DIR = join(process.cwd(), 'your-packages-dir');
```

### æ·»åŠ æ„å»ºé’©å­

åœ¨å‘å¸ƒå‰æ‰§è¡Œé¢å¤–æ“ä½œï¼Œä¿®æ”¹ `publish.ts`ï¼š

```typescript
function publishPackage(pkgName: string): void {
  const pkgPath = join(PACKAGES_DIR, pkgName);

  // æ·»åŠ è‡ªå®šä¹‰é€»è¾‘
  execSync(`cd ${pkgPath} && pnpm lint`, { stdio: 'inherit' });

  // åŸæœ‰é€»è¾‘...
}
```

### ä¿®æ”¹è¾“å‡ºæ ·å¼

ä½¿ç”¨ `chalk` è‡ªå®šä¹‰é¢œè‰²ï¼š

```typescript
import chalk from 'chalk';

console.log(chalk.green('âœ“ æˆåŠŸ'));
console.log(chalk.red('âœ— å¤±è´¥'));
console.log(chalk.cyan('ğŸ”— æç¤º'));
console.log(chalk.yellow('âš  è­¦å‘Š'));
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: yalc å‘½ä»¤æœªæ‰¾åˆ°

**é”™è¯¯**ï¼š
```
yalc: command not found
```

**è§£å†³**ï¼š
```bash
npm install -g yalc
# æˆ–
pnpm link:setup
```

---

### é—®é¢˜ 2: æ„å»ºå¤±è´¥

**é”™è¯¯**ï¼š
```
âœ— button æ„å»ºå¤±è´¥
```

**è§£å†³**ï¼š
```bash
# æ‰‹åŠ¨æ„å»ºæ£€æŸ¥é”™è¯¯
cd packages/button
pnpm build

# æ£€æŸ¥æ—¥å¿—
```

---

### é—®é¢˜ 3: æ¨é€åä¸šåŠ¡é¡¹ç›®æœªæ›´æ–°

**å¯èƒ½åŸå› **ï¼š
1. ä¸šåŠ¡é¡¹ç›®æœªä½¿ç”¨ yalc link
2. éœ€è¦é‡å¯ dev æœåŠ¡å™¨

**è§£å†³**ï¼š
```bash
# åœ¨ä¸šåŠ¡é¡¹ç›®
yalc check  # æ£€æŸ¥é“¾æ¥çŠ¶æ€
yalc update # æ‰‹åŠ¨æ›´æ–°

# é‡å¯å¼€å‘æœåŠ¡å™¨
pnpm dev
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆ†åŒ…å‘å¸ƒ

ä¸è¦æ€»æ˜¯é€‰æ‹©"å…¨éƒ¨"ï¼Œåªå‘å¸ƒä¿®æ”¹çš„åŒ…ï¼š

```bash
pnpm link:publish
# åªé€‰æ‹© @aix/button
```

### 2. è§‚å¯Ÿæ„å»ºè¾“å‡º

å¦‚æœæ„å»ºå¤±è´¥ï¼Œä»”ç»†æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼š

```bash
# æ‰‹åŠ¨æ„å»ºæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cd packages/button
pnpm build
```

### 3. å®šæœŸæ¸…ç† Yalc ç¼“å­˜

```bash
# æ¸…ç†æ‰€æœ‰ Yalc ç¼“å­˜
yalc installations clean
```

---

## ğŸš€ é«˜çº§ç”¨æ³•

### æ‰¹å¤„ç†è„šæœ¬

åˆ›å»ºè‡ªå®šä¹‰æ‰¹å¤„ç†è„šæœ¬ï¼š

```bash
#!/bin/bash
# scripts/link/publish-all.sh

echo "æ„å»ºæ‰€æœ‰åŒ…..."
pnpm build

echo "å‘å¸ƒæ‰€æœ‰åŒ…åˆ° Yalc..."
pnpm link:publish

echo "å®Œæˆï¼"
```

### CI/CD é›†æˆ

åœ¨ CI ä¸­ä½¿ç”¨è¿™äº›è„šæœ¬ï¼š

```yaml
# .gitlab-ci.yml
test-linking:
  script:
    - pnpm link:setup
    - pnpm link:publish
    - cd test-project
    - yalc add @aix/button
    - pnpm test
```

---

## ğŸ“Š è„šæœ¬å¯¹æ¯”

| è„šæœ¬ | ç”¨é€” | é¢‘ç‡ | æ„å»º | æ¨é€ |
|-----|------|------|------|------|
| **setup.ts** | ç¯å¢ƒæ£€æŸ¥ | ä¸€æ¬¡ | âŒ | âŒ |
| **publish.ts** | é¦–æ¬¡å‘å¸ƒ | ä½ | âœ… | âœ… |
| **push.ts** | å¿«é€Ÿæ›´æ–° | é«˜ | âœ… | âœ… |

---

## æ›´æ–°æ—¥å¿—

- **2025-01-XX**: åˆå§‹ç‰ˆæœ¬
  - âœ… setup.ts - ç¯å¢ƒæ£€æŸ¥
  - âœ… publish.ts - äº¤äº’å¼å‘å¸ƒ
  - âœ… push.ts - å¿«é€Ÿæ¨é€
- **2025-01-XX**: ä¼˜åŒ–ç›®å½•ç»“æ„
  - âœ… ç»Ÿä¸€æ”¾å…¥ scripts/link/ ç›®å½•
  - âœ… æ·»åŠ å®Œæ•´æ–‡æ¡£

---

## è´¡çŒ®æŒ‡å—

å¦‚éœ€æ”¹è¿›è¿™äº›è„šæœ¬ï¼š

1. åœ¨ `scripts/link/` ç›®å½•ä¸‹ä¿®æ”¹
2. æµ‹è¯•æ‰€æœ‰åœºæ™¯ï¼ˆé¦–æ¬¡å‘å¸ƒã€æ›´æ–°ã€é”™è¯¯å¤„ç†ï¼‰
3. æ›´æ–°æœ¬ README
4. æäº¤ PR

---

æ„‰å¿«åœ°ä½¿ç”¨è”è°ƒå·¥å…·ï¼ğŸ‰
