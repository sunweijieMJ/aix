openapi: 3.0.0
info:
  title: Base Node Server API
  version: 1.0.0
  description: |
    é…ç½®ç®¡ç†æœåŠ¡ API æ–‡æ¡£

    ### åŠŸèƒ½ç‰¹æ€§

    - ğŸ” JWT è®¤è¯æˆæƒ
    - ğŸ“ é…ç½®ç®¡ç† CRUD æ“ä½œ
    - ğŸ’¾ ç¼“å­˜ç®¡ç†å’Œç»Ÿè®¡
    - ğŸ“Š å¥åº·æ£€æŸ¥å’Œæ€§èƒ½ç›‘æ§
    - ğŸ”’ å®‰å…¨é˜²æŠ¤ï¼ˆCORSã€é™æµã€XSSï¼‰
    - ğŸ“„ æ ‡å‡†åŒ–çš„ API å“åº”æ ¼å¼

    ### è®¤è¯è¯´æ˜

    å¤§éƒ¨åˆ† API éœ€è¦ Bearer Token è®¤è¯ï¼š

    1. è°ƒç”¨ POST /auth/login è·å– JWT token
    2. åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ : Authorization: Bearer <token>
    3. Token é»˜è®¤æœ‰æ•ˆæœŸ 24 å°æ—¶

    ### å“åº”æ ¼å¼

    æ‰€æœ‰ API å“åº”éµå¾ªç»Ÿä¸€æ ¼å¼ï¼š

    ```json
    {
      "code": 0,           // çŠ¶æ€ç ï¼š0 è¡¨ç¤ºæˆåŠŸ
      "message": "æˆåŠŸ",   // å“åº”æ¶ˆæ¯
      "result": {}         // å“åº”æ•°æ®
    }
    ```

    ### é”™è¯¯ç è¯´æ˜

    - **0**: æˆåŠŸ
    - **-1**: ä¸€èˆ¬é”™è¯¯
    - **-401**: æœªæˆæƒ
    - **-403**: ç¦æ­¢è®¿é—®
    - **-404**: èµ„æºä¸å­˜åœ¨
    - **-409**: èµ„æºå†²çª
    - **-500**: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  contact:
    name: Node Team
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
servers:
  - url: http://localhost:3001/local/v1
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: http://0.0.0.0:3001/local/v1
    description: æœ¬åœ°ç½‘ç»œæœåŠ¡å™¨
tags:
  - name: Auth
    description: è®¤è¯æˆæƒ - ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€tokenç®¡ç†
  - name: Config
    description: é…ç½®ç®¡ç† - æä¾›é…ç½®çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'JWT è®¤è¯ä»¤ç‰Œï¼Œæ ¼å¼: Bearer <token>'
  schemas:
    ApiResponse:
      type: object
      properties:
        code:
          type: integer
          description: çŠ¶æ€ç ï¼Œ0 è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–å€¼è¡¨ç¤ºé”™è¯¯
          example: 0
        message:
          type: string
          description: å“åº”æ¶ˆæ¯
          example: æ“ä½œæˆåŠŸ
        result:
          type: object
          description: å“åº”æ•°æ®
          nullable: true
    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
          description: é”™è¯¯ç 
          example: -1
        message:
          type: string
          description: é”™è¯¯ä¿¡æ¯
          example: æ“ä½œå¤±è´¥
        result:
          type: object
          nullable: true
    User:
      type: object
      properties:
        id:
          type: string
          description: ç”¨æˆ·ID
          example: 550e8400-e29b-41d4-a716-446655440000
        username:
          type: string
          description: ç”¨æˆ·å
          example: admin
        email:
          type: string
          format: email
          description: é‚®ç®±åœ°å€
          example: admin@example.com
        role:
          type: string
          enum:
            - admin
            - user
            - guest
          description: ç”¨æˆ·è§’è‰²
          example: admin
        createdAt:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ—¶é—´
    Config:
      type: object
      properties:
        key:
          type: string
          description: é…ç½®é”®
          example: app.name
        value:
          type: string
          description: é…ç½®å€¼
          example: My App
        description:
          type: string
          description: é…ç½®æè¿°
          example: åº”ç”¨åç§°
        createdAt:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ—¶é—´
    TokenResponse:
      type: object
      properties:
        token:
          type: string
          description: JWT token
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        expiresIn:
          type: string
          description: Token è¿‡æœŸæ—¶é—´
          example: 24h
        user:
          $ref: '#/components/schemas/User'
    HealthCheck:
      type: object
      properties:
        status:
          type: string
          enum:
            - healthy
            - unhealthy
          description: å¥åº·çŠ¶æ€
          example: healthy
        timestamp:
          type: string
          format: date-time
          description: æ£€æŸ¥æ—¶é—´
        uptime:
          type: number
          description: è¿è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
          example: 3600
        database:
          type: object
          properties:
            status:
              type: string
              enum:
                - healthy
                - unhealthy
            responseTime:
              type: number
              description: å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        cache:
          type: object
          properties:
            status:
              type: string
              enum:
                - healthy
                - unhealthy
            type:
              type: string
              description: ç¼“å­˜ç±»å‹
              example: memory
  responses:
    Success:
      description: æ“ä½œæˆåŠŸ
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: æœªæˆæƒæˆ– Token æ— æ•ˆ
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ErrorResponse'
              - example:
                  code: -401
                  message: Unauthorized
                  result: null
    Forbidden:
      description: ç¦æ­¢è®¿é—®
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ErrorResponse'
              - example:
                  code: -403
                  message: Forbidden
                  result: null
    NotFound:
      description: èµ„æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ErrorResponse'
              - example:
                  code: -404
                  message: Not Found
                  result: null
    ServerError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ErrorResponse'
              - example:
                  code: -500
                  message: Internal Server Error
                  result: null
security:
  - bearerAuth: []
paths:
  /auth/register:
    post:
      summary: ç”¨æˆ·æ³¨å†Œ
      description: æ³¨å†Œæ–°ç”¨æˆ·è´¦å·
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 50
                  description: ç”¨æˆ·åï¼ˆ3-50ä¸ªå­—ç¬¦ï¼‰
                  example: johndoe
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  description: ç”¨æˆ·æ˜¾ç¤ºåç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨usernameï¼‰
                  example: John Doe
                email:
                  type: string
                  format: email
                  description: ç”µå­é‚®ç®±
                  example: johndoe@example.com
                password:
                  type: string
                  minLength: 8
                  format: password
                  description: å¯†ç ï¼ˆè‡³å°‘8ä¸ªå­—ç¬¦ï¼Œéœ€åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼‰
                  example: StrongPass123!
                role:
                  type: string
                  enum:
                    - admin
                    - user
                    - guest
                  description: ç”¨æˆ·è§’è‰²ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºuserï¼‰
                  example: user
      responses:
        '200':
          description: æ³¨å†ŒæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 0
                  message:
                    type: string
                    example: User registered successfully
                  result:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      username:
                        type: string
                        example: johndoe
                      name:
                        type: string
                        example: John Doe
                      email:
                        type: string
                        example: johndoe@example.com
                      role:
                        type: string
                        example: user
                      createdAt:
                        type: string
                        format: date-time
                        example: '2024-01-01T00:00:00.000Z'
                      updatedAt:
                        type: string
                        format: date-time
                        example: '2024-01-01T00:00:00.000Z'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯ï¼ˆå¯†ç å¤ªå¼±ã€ç”¨æˆ·åå·²å­˜åœ¨ç­‰ï¼‰
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: -2
                  message:
                    type: string
                    example: Username already exists
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  /auth/login:
    post:
      summary: ç”¨æˆ·ç™»å½•
      description: ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•ï¼Œè·å–è®¿é—®ä»¤ç‰Œ
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: ç”¨æˆ·å
                  example: admin
                password:
                  type: string
                  format: password
                  description: å¯†ç 
                  example: admin123
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 0
                  message:
                    type: string
                    example: Login successful
                  result:
                    type: object
                    properties:
                      token:
                        type: string
                        description: JWTè®¿é—®ä»¤ç‰Œ
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      user:
                        type: object
                        properties:
                          id:
                            type: integer
                            example: 1
                          username:
                            type: string
                            example: admin
                          email:
                            type: string
                            example: admin@example.com
                          role:
                            type: string
                            example: admin
                          createdAt:
                            type: string
                            format: date-time
                          updatedAt:
                            type: string
                            format: date-time
                      expiresIn:
                        type: integer
                        description: ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
                        example: 86400
        '400':
          description: è¯·æ±‚å‚æ•°ç¼ºå¤±
        '401':
          description: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: -4
                  message:
                    type: string
                    example: Invalid username or password
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  /auth/refresh:
    post:
      summary: åˆ·æ–°è®¿é—®ä»¤ç‰Œ
      description: ä½¿ç”¨ç°æœ‰ä»¤ç‰Œåˆ·æ–°è·å–æ–°çš„è®¿é—®ä»¤ç‰Œ
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: å½“å‰çš„JWTä»¤ç‰Œ
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: ä»¤ç‰Œåˆ·æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 0
                  message:
                    type: string
                    example: Token refreshed successfully
                  result:
                    type: object
                    properties:
                      token:
                        type: string
                        description: æ–°çš„JWTè®¿é—®ä»¤ç‰Œ
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      expiresIn:
                        type: integer
                        description: ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
                        example: 86400
        '400':
          description: ä»¤ç‰Œç¼ºå¤±
        '401':
          description: ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  /auth/userinfo:
    get:
      summary: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
      description: è·å–å½“å‰å·²è®¤è¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
      tags:
        - Auth
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 0
                  message:
                    type: string
                    example: User info retrieved successfully
                  result:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      username:
                        type: string
                        example: johndoe
                      name:
                        type: string
                        example: John Doe
                      email:
                        type: string
                        example: johndoe@example.com
                      role:
                        type: string
                        example: user
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
        '401':
          description: æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: -4
                  message:
                    type: string
                    example: No token provided
        '404':
          description: ç”¨æˆ·ä¸å­˜åœ¨
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  /auth/logout:
    post:
      summary: ç”¨æˆ·ç™»å‡º
      description: ç™»å‡ºå½“å‰ç”¨æˆ·ï¼ˆå®¢æˆ·ç«¯åº”åˆ é™¤å­˜å‚¨çš„ä»¤ç‰Œï¼‰
      tags:
        - Auth
      security:
        - bearerAuth: []
      responses:
        '200':
          description: ç™»å‡ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 0
                  message:
                    type: string
                    example: Logout successful
                  result:
                    type: object
                    nullable: true
                    example: null
        '401':
          description: æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  /auth/validate:
    get:
      summary: éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§
      description: æ£€æŸ¥æä¾›çš„ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆï¼ˆå¯é€‰è®¤è¯ï¼Œä¸å¼ºåˆ¶è¦æ±‚ä»¤ç‰Œï¼‰
      tags:
        - Auth
      parameters:
        - in: header
          name: Authorization
          schema:
            type: string
          required: false
          description: Bearer token (å¯é€‰)
          example: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: éªŒè¯ç»“æœ
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 0
                  message:
                    type: string
                    example: Token is valid
                  result:
                    type: object
                    properties:
                      valid:
                        type: boolean
                        description: ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
                        example: true
                      user:
                        type: object
                        nullable: true
                        description: ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼‰
                        properties:
                          userId:
                            type: integer
                            example: 1
                          username:
                            type: string
                            example: johndoe
                          role:
                            type: string
                            example: user
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
  /config:
    get:
      summary: è·å–æ‰€æœ‰é…ç½®
      description: è¿”å›æ‰€æœ‰é…ç½®é¡¹åˆ—è¡¨
      tags:
        - Config
      security:
        - bearerAuth: []
      responses:
        '200':
          description: æˆåŠŸè·å–æ‰€æœ‰é…ç½®
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
  /config/{path}:
    get:
      summary: æ ¹æ®è·¯å¾„è·å–é…ç½®
      description: æ ¹æ®æŒ‡å®šè·¯å¾„è·å–é…ç½®é¡¹
      tags:
        - Config
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: é…ç½®è·¯å¾„ï¼ˆç‚¹åˆ†å‰²ï¼‰
          example: app.setting.theme
      responses:
        '200':
          description: æˆåŠŸè·å–é…ç½®
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: é…ç½®ä¸å­˜åœ¨
    put:
      summary: åˆ›å»ºæˆ–æ›´æ–°é…ç½®
      description: æ ¹æ®è·¯å¾„åˆ›å»ºæ–°é…ç½®æˆ–æ›´æ–°å·²å­˜åœ¨çš„é…ç½®
      tags:
        - Config
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: path
          required: true
          schema:
            type: string
          description: é…ç½®è·¯å¾„
          example: app.setting.theme
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - value
              properties:
                value:
                  type: object
                  description: é…ç½®å€¼ï¼ˆJSONå¯¹è±¡ï¼‰
                  example:
                    color: blue
                    mode: dark
      responses:
        '200':
          description: é…ç½®ä¿å­˜æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
